<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penguin Prediction</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>Penguins of Madagascar Classifier</h1>
        <p class="prediction-title">Latest Penguin Species Prediction:</p>
        
        <div id="prediction-box">
            <div id="prediction" class="species loading">Loading...</div>
        </div>
        
        <p class="timestamp" id="timestamp"></p>
        
        <!-- Dashboard Grid Layout -->
        <div class="dashboard-grid">
            <!-- Penguin Data Section -->
            <div id="penguin-data">
                <h3>Penguin Measurements</h3>
                <div class="data-grid" id="data-grid">
                    <!-- Data will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Probability Chart Section -->
            <div id="probability-chart">
                <h3>Prediction Probabilities</h3>
                <div id="prob-bars">
                    <!-- Probability bars will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Feature Explanation Section -->
            <div id="feature-explanation">
                <h3>Why This Prediction?</h3>
                <p>The features below had the strongest influence on this classification:</p>
                <div id="feature-importance-viz">
                    <!-- Feature importance visualization will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        async function fetchPrediction() {
            try {
                const response = await fetch('latest_prediction.json');
                if (!response.ok) {
                    throw new Error("Failed to fetch prediction.");
                }
                const data = await response.json();
                
                // Update prediction and remove loading class
                const predictionEl = document.getElementById('prediction');
                
                // Make the prediction display more fun with conditional messages
                // Add a loading animation before showing the result
                predictionEl.innerHTML = `<div class="loading-animation"></div>`;
                
                // Delay the result to show the loading animation
                setTimeout(() => {
                    if (data.predicted_species === 'Adelie') {
                        predictionEl.innerHTML = `<div class="species-icon adelie">üêß</div> <strong>Adelie Penguin Found!</strong> <div class="species-tagline">Skipper, is that you? üéñÔ∏è</div>`;
                        predictionEl.className = 'species adelie';
                    } else if (data.predicted_species === 'Chinstrap') {
                        predictionEl.innerHTML = `<div class="species-icon chinstrap">üêß</div> <strong>Chinstrap Penguin Detected!</strong> <div class="species-tagline">Kowalski, analysis! Not our target.</div>`;
                        predictionEl.className = 'species chinstrap';
                    } else if (data.predicted_species === 'Gentoo') {
                        predictionEl.innerHTML = `<div class="species-icon gentoo">üêß</div> <strong>Gentoo Penguin Spotted!</strong> <div class="species-tagline">Private, log this one! Mission continues.</div>`;
                        predictionEl.className = 'species gentoo';
                    } else {
                        predictionEl.innerHTML = `<div class="species-icon">üêß</div> <strong>Species: ${data.predicted_species}</strong>`;
                        predictionEl.className = 'species';
                    }
                    // Remove loading class after content is updated
                    predictionEl.classList.remove('loading');
                }, 800);
                
                // Update timestamp
                document.getElementById('timestamp').innerText = `Last updated: ${data.timestamp}`;
                
                // Update penguin data
                const dataGrid = document.getElementById('data-grid');
                dataGrid.innerHTML = '';
                
                for (const [key, value] of Object.entries(data.penguin_data)) {
                    if (key !== 'datetime') {
                        const dataItem = document.createElement('div');
                        dataItem.className = 'data-item';
                        
                        const label = document.createElement('div');
                        label.className = 'data-label';
                        label.innerText = formatLabel(key);
                        
                        const dataValue = document.createElement('div');
                        dataValue.className = 'data-value';
                        dataValue.innerText = formatValue(key, value);
                        
                        dataItem.appendChild(label);
                        dataItem.appendChild(dataValue);
                        dataGrid.appendChild(dataItem);
                    }
                }
                
                // Update probability bars
                const probBars = document.getElementById('prob-bars');
                probBars.innerHTML = '';
                
                const speciesMap = {
                    '0': 'Adelie',
                    '1': 'Chinstrap',
                    '2': 'Gentoo'
                };
                
                for (const [key, value] of Object.entries(data.probabilities)) {
                    const species = speciesMap[key] || key;
                    
                    const barContainer = document.createElement('div');
                    barContainer.className = 'prob-bar-container';
                    
                    const label = document.createElement('div');
                    label.className = 'data-label';
                    
                    // No species icon for cleaner look
                    const speciesIcon = document.createElement('span');
                    speciesIcon.className = `species-indicator ${species.toLowerCase()}`;
                    // Removed emoji for cleaner presentation
                    label.appendChild(speciesIcon);
                    
                    const speciesText = document.createElement('span');
                    speciesText.innerText = species;
                    label.appendChild(speciesText);
                    
                    const bar = document.createElement('div');
                    bar.className = `prob-bar prob-${species.toLowerCase()}`;
                    bar.style.width = `${value * 100}%`;
                    
                    // Add percentage with better formatting
                    const percentage = Math.round(value * 100);
                    // Create a separate container for the percentage that spans the entire bar container
                    const percentageSpan = document.createElement('span');
                    percentageSpan.className = 'prob-value';
                    percentageSpan.innerText = `${percentage}%`;
                    barContainer.appendChild(percentageSpan);
                    // Keep the bar clean without text inside
                    bar.innerHTML = '';
                    
                    // Highlight the predicted species
                    if (species === data.predicted_species) {
                        barContainer.classList.add('predicted');
                        label.classList.add('predicted-label');
                    }
                    
                    barContainer.appendChild(bar);
                    
                    const barWrapper = document.createElement('div');
                    barWrapper.className = 'bar-wrapper';
                    barWrapper.appendChild(label);
                    barWrapper.appendChild(barContainer);
                    
                    probBars.appendChild(barWrapper);
                }
                
                // Update feature importance visualization
                updateFeatureImportance(data);
                
            } catch (error) {
                document.getElementById('prediction').innerText = 'Error loading prediction.';
                document.getElementById('timestamp').innerText = '';
            }
        }
        
        function formatLabel(key) {
            return key.split('_').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }
        
        function formatValue(key, value) {
            if (key.includes('mm')) {
                return `${value.toFixed(1)} mm`;
            } else if (key.includes('g')) {
                return `${value.toFixed(0)} g`;
            }
            return value;
        }
        
        function updateFeatureImportance(data) {
            const featureImportanceViz = document.getElementById('feature-importance-viz');
            featureImportanceViz.innerHTML = '';
            
            // Feature importance values (based on model analysis)
            // These values represent the relative importance of each feature in the model
            const featureImportance = {
                'bill_length_mm': 0.35,  // Most important feature
                'flipper_length_mm': 0.32,
                'body_mass_g': 0.22,
                'bill_depth_mm': 0.11   // Least important feature
            };
            
            // Species typical values (approximate means for each species)
            const speciesTypicalValues = {
                'Adelie': {
                    'bill_length_mm': 38.8,
                    'bill_depth_mm': 18.3,
                    'flipper_length_mm': 190.0,
                    'body_mass_g': 3700
                },
                'Chinstrap': {
                    'bill_length_mm': 48.8,
                    'bill_depth_mm': 18.4,
                    'flipper_length_mm': 195.8,
                    'body_mass_g': 3700
                },
                'Gentoo': {
                    'bill_length_mm': 47.5,
                    'bill_depth_mm': 15.0,
                    'flipper_length_mm': 217.0,
                    'body_mass_g': 5100
                }
            };
            
            // Sort features by importance
            const sortedFeatures = Object.entries(featureImportance)
                .sort((a, b) => b[1] - a[1])
                .map(entry => entry[0]);
            
            // Create feature importance visualization
            for (const feature of sortedFeatures) {
                const featureContainer = document.createElement('div');
                featureContainer.className = 'feature-container';
                
                // Feature header with importance indicator
                const featureHeader = document.createElement('div');
                featureHeader.className = 'feature-header';
                
                const featureLabel = document.createElement('div');
                featureLabel.className = 'feature-label';
                featureLabel.innerText = formatLabel(feature);
                
                const importanceIndicator = document.createElement('div');
                importanceIndicator.className = 'importance-indicator';
                importanceIndicator.style.width = `${featureImportance[feature] * 100}%`;
                importanceIndicator.innerText = `${Math.round(featureImportance[feature] * 100)}%`;
                
                featureHeader.appendChild(featureLabel);
                featureHeader.appendChild(importanceIndicator);
                
                // Feature comparison visualization
                const comparisonViz = document.createElement('div');
                comparisonViz.className = 'feature-comparison';
                
                // Current penguin value
                const currentValue = data.penguin_data[feature];
                const currentValueEl = document.createElement('div');
                currentValueEl.className = 'current-value';
                currentValueEl.innerText = `Current: ${formatValue(feature, currentValue)}`;
                
                // Species comparison
                const speciesComparison = document.createElement('div');
                speciesComparison.className = 'species-comparison';
                
                for (const [species, values] of Object.entries(speciesTypicalValues)) {
                    const speciesValue = values[feature];
                    const speciesValueEl = document.createElement('div');
                    speciesValueEl.className = `species-value ${species.toLowerCase()}`;
                    speciesValueEl.innerText = `${species}: ${formatValue(feature, speciesValue)}`;
                    
                    // Highlight the species that matches the prediction
                    if (species === data.predicted_species) {
                        speciesValueEl.classList.add('predicted');
                    }
                    
                    speciesComparison.appendChild(speciesValueEl);
                }
                
                comparisonViz.appendChild(currentValueEl);
                comparisonViz.appendChild(speciesComparison);
                
                featureContainer.appendChild(featureHeader);
                featureContainer.appendChild(comparisonViz);
                
                featureImportanceViz.appendChild(featureContainer);
            }
        }

        fetchPrediction();
        
        // Auto-refresh prediction every 30 seconds
        setInterval(fetchPrediction, 30000);
    </script>
</body>
</html>
