<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penguin Prediction</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>Penguins of Madagascar Classifier</h1>
        <p>Latest Penguin Species Prediction:</p>
        
        <div id="prediction-box">
            <div id="prediction" class="species loading">Loading...</div>
        </div>
        
        <p class="timestamp" id="timestamp"></p>
        
        <!-- Penguin Data Section -->
        <div id="penguin-data">
            <h3>Penguin Measurements</h3>
            <div class="data-grid" id="data-grid">
                <!-- Data will be populated by JavaScript -->
            </div>
        </div>
        
        <!-- Probability Chart Section -->
        <div id="probability-chart">
            <h3>Prediction Probabilities</h3>
            <div id="prob-bars">
                <!-- Probability bars will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        let predictionData = null;
        
        async function fetchPrediction() {
            try {
                const response = await fetch('latest_prediction.json');
                if (!response.ok) {
                    throw new Error("Failed to fetch prediction.");
                }
                predictionData = await response.json();
                
                // Update penguin data immediately
                updatePenguinData(predictionData);
                
                // Set up the guessing game
                setupGuessingGame();
                
                return predictionData;
            } catch (error) {
                document.getElementById('prediction').innerText = 'Error loading prediction.';
                document.getElementById('timestamp').innerText = '';
                return null;
            }
        }
        
        function updatePenguinData(data) {
            // Update penguin data
            const dataGrid = document.getElementById('data-grid');
            dataGrid.innerHTML = '';
            
            for (const [key, value] of Object.entries(data.penguin_data)) {
                if (key !== 'datetime') {
                    const dataItem = document.createElement('div');
                    dataItem.className = 'data-item';
                    
                    const label = document.createElement('div');
                    label.className = 'data-label';
                    label.innerText = formatLabel(key);
                    
                    const dataValue = document.createElement('div');
                    dataValue.className = 'data-value';
                    dataValue.innerText = formatValue(key, value);
                    
                    dataItem.appendChild(label);
                    dataItem.appendChild(dataValue);
                    dataGrid.appendChild(dataItem);
                }
            }
        }
        
        function updatePredictionDisplay(data) {
            // Update prediction and remove loading class
            const predictionEl = document.getElementById('prediction');
            predictionEl.innerText = `Species: ${data.predicted_species}`;
            predictionEl.classList.remove('loading');
            
            // Update timestamp
            document.getElementById('timestamp').innerText = `Last updated: ${data.timestamp}`;
            
            // Update probability bars
            const probBars = document.getElementById('prob-bars');
            probBars.innerHTML = '';
            
            const speciesMap = {
                '0': 'Adelie',
                '1': 'Chinstrap',
                '2': 'Gentoo'
            };
            
            for (const [key, value] of Object.entries(data.probabilities)) {
                const species = speciesMap[key] || key;
                
                const barContainer = document.createElement('div');
                barContainer.className = 'prob-bar-container';
                
                const label = document.createElement('div');
                label.className = 'data-label';
                label.innerText = species;
                
                const bar = document.createElement('div');
                bar.className = `prob-bar prob-${species.toLowerCase()}`;
                bar.style.width = `${value * 100}%`;
                bar.innerText = `${Math.round(value * 100)}%`;
                
                barContainer.appendChild(label);
                barContainer.appendChild(bar);
                probBars.appendChild(barContainer);
            }
        }
        
        function formatLabel(key) {
            // Format the label from snake_case to Title Case
            return key.split('_').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }
        
        function formatValue(key, value) {
            // Format the value based on the key
            if (key.includes('mm')) {
                return `${value.toFixed(1)} mm`;
            } else if (key.includes('g')) {
                return `${value.toFixed(0)} g`;
            }
            return value;
        }
        
        function setupGuessingGame() {
            // Update the prediction display after a short delay
            // This creates a simple reveal effect
            setTimeout(() => {
                if (predictionData) {
                    updatePredictionDisplay(predictionData);
                }
            }, 1500);
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            fetchPrediction();
            
            // Refresh data every 5 minutes
            setInterval(fetchPrediction, 5 * 60 * 1000);
        });
    </script>
</body>
</html>
